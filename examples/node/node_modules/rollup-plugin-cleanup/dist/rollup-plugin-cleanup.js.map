{"version":3,"file":"rollup-plugin-cleanup.js","sources":["../src/create-filter.js","../src/parse-options.js","../src/index.js"],"sourcesContent":["\nimport { createFilter } from 'rollup-pluginutils'\n\nconst justExt = (file) => {\n  const match = /[^/\\\\]\\.([^./\\\\]*)$/.exec(file)\n  return match ? match[1] : ''\n}\n\n/**\n * Creates a filter for the options `include`, `exclude`, and `extensions`.\n * Since `extensions` is not a rollup option, I think is widely used.\n *\n * @param {object} opts? - The user options\n * @returns {function}     Filter function that returns true if a given\n *                         file matches the filter.\n */\nconst _createFilter = function (opts) {\n\n  const filter = createFilter(opts.include, opts.exclude)\n\n  let exts = opts.extensions || ['js', 'jsx']\n  if (!Array.isArray(exts)) {\n    exts = [exts]\n  }\n\n  for (let i = 0; i < exts.length; i++) {\n    const e = exts[i]\n    if (e === '*') {\n      return filter\n    }\n    if (e[0] === '.') {\n      exts[i] = e.substr(1)\n    }\n  }\n\n  return function (name) {\n    return filter(name) && exts.indexOf(justExt(name)) > -1\n  }\n}\n\nexport default _createFilter\n","import cleanup from 'js-cleanup'\n\n// Support for deprecated filters\nconst translateFilter = function (item, ix, arr) {\n  switch (item) {\n    case 'srcmaps':\n      arr[ix] = 'sources'\n      break\n    // istanbul ignore next\n    case 'jscs':\n      arr[ix] = /^[/*]\\s*jscs:[ed]/\n      break\n  }\n}\n\n// multiple forms to specify comment filters, default is 'some'\nconst getFilters = (filters) => {\n\n  if (typeof filters === 'boolean') {\n    return filters === true ? 'all' : 'none'\n  }\n\n  if (filters) {\n    filters = Array.isArray(filters) ? filters : [filters]\n    filters.forEach(translateFilter)\n    // throws on unknown filters\n    cleanup('', null, { comments: filters, sourcemap: false })\n  }\n\n  return filters || 'some'\n}\n\nconst parseOptions = (options) => {\n  const comments = getFilters(options.comments)\n\n  return {\n    comments,\n    compactComments: options.compactComments !== false,\n    lineEndings: options.lineEndings || options.normalizeEols,\n    maxEmptyLines: options.maxEmptyLines | 0,\n    sourcemap: options.sourceMap !== false && options.sourcemap !== false,\n  }\n}\n\nexport default parseOptions\n","import cleanup from 'js-cleanup'\nimport createFilter from './create-filter'\nimport parseOptions from './parse-options'\n\n/**\n * Returns the rollup-plugin-cleanup instance.\n * @param   {Object} options - Plugin's user options\n * @returns {Object} Plugin instance.\n */\nconst rollupCleanup = function (options) {\n  options = options || {}\n\n  // merge include, exclude, and extensions\n  const filter = createFilter(options)\n\n  // validate and clone the plugin options\n  options = parseOptions(options)\n\n  // the plugin instance\n  return {\n\n    name: 'cleanup',\n\n    transform(code, id) {\n\n      if (filter(id)) {\n        return new Promise((resolve) => {\n          try {\n            resolve(cleanup(code, id, options))\n          } catch (err) {\n            // istanbul ignore else\n            if ('position' in err && this.error) {\n              this.error(err.message, err.position)\n            } else {\n              throw err\n            }\n          }\n        })\n      }\n\n      return null\n    },\n  }\n}\n\nexport default rollupCleanup\n"],"names":["createFilter"],"mappings":"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"}